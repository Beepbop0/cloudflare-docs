---
title: Upload video files
pcx-content-type: how to
weight: 3
meta:
  title: Upload video files
---

# Upload video files

This option for uploading videos is ideal when the video is stored on a computer with access to your API tokens.

## Basic Uploads (small videos)

For files smaller than 200 MB, you can use form based uploads, but this option does not support resumable uploading.

Make an HTTP request with content-type header set to `multipart/form-data` and include the media as an input with the name set to `file`.
{{<raw>}}<pre class="CodeBlock CodeBlock-with-rows CodeBlock-scrolls-horizontally CodeBlock-is-light-in-light-theme CodeBlock--language-bash" language="bash"><code><span class="CodeBlock--rows"><span class="CodeBlock--rows-content"><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-function">curl</span><span class="CodeBlock--token-plain"> -X POST </span><span class="CodeBlock--token-punctuation">\</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">-H </span><span class="CodeBlock--token-string">&quot;Authorization: Bearer </span><span class="CodeBlock--token-string CodeBlock--token-variable">$TOKEN</span><span class="CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">\</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">-F </span><span class="CodeBlock--token-assign-left CodeBlock--token-variable">file</span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain">@/Users/kyle/Desktop/video.mp4 </span><span class="CodeBlock--token-punctuation">\</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">https://api.cloudflare.com/client/v4/accounts/</span><span class="CodeBlock--token-variable">$ACCOUNT</span><span class="CodeBlock--token-plain">/stream</span></div></span></span></span></code></pre>{{</raw>}}

<Aside type="note">

Note that cURL `-F` flag automatically configures the content-type header and maps `skiing.mp4` to a form input called `file`.

</Aside>

## Resumable uploads with tus (large files)

The [tus protocol](https://tus.io) is the recommended method for uploading large files to Cloudflare Stream from a computer, and popular programming languages have [tus client implementations](https://tus.io/implementations.html).

tus is a protocol based on HTTP for resumable file uploads. Resumable means that an upload can be interrupted at any moment and can be resumed without re-uploading the previous data again. An interruption may happen willingly, if the user wants to pause, or by accident in case of an network issue or server outage.

Cloudflare Stream requires a minimum chunk size of 5,242,880 bytes when using tus, unless the entire file is less than this amount.

We recommend increasing the chunk size to 52,428,800 bytes for better performance when the client connection is expected to be reliable. The maximum chunk size can be 209,715,200 bytes.

<Aside type="note">

Cloudflare Stream requires a chunk size divisible by 256 KiB (256x1024 bytes). Round your desired chunk size to the nearest multiple of 256 KiB.

The final chunk of an upload or uploads that fit within a single chunk are exempt from this requirement.

</Aside>

## Specify upload options

The tus protocol allows you to add optional parameters in the [`Upload-Metadata` header](https://tus.io/protocols/resumable-upload.html#upload-metadata) and setting the arbitrary metadata values in the `Upload-Metadata` header sets values in the meta key in the Stream API. For a list of acceptable values, refer to the [Upload a video from a URL endpoint's optional parameters](https://api.cloudflare.com/#stream-videos-properties).


## Get the video ID using tus

When an initial tus request is made, Stream responds with a URL in the location header. While this URL may contain the video ID, we do not recommend parsing this URL to get the ID.

Instead, use the `stream-media-id` HTTP header in the response to retrieve the video ID.

For example, using the tus protocol to make a request to `https://api.cloudflare.com/client/v4/accounts/$ACCOUNT/stream`
will contain an HTTP header like the one below.

```bash
stream-media-id: cab807e0c477d01baq20f66c3d1dfc26cf
```

### Command-line

You will also need to download a tus client. This example will use the [tus Python client](https://github.com/tus/tus-py-client), available through pip, Python's package manager.
{{<raw>}}<pre class="CodeBlock CodeBlock-with-rows CodeBlock-scrolls-horizontally CodeBlock-is-light-in-light-theme CodeBlock--language-bash" language="bash"><code><span class="CodeBlock--rows"><span class="CodeBlock--rows-content"><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">pip </span><span class="CodeBlock--token-function">install</span><span class="CodeBlock--token-plain"> -U tus.py</span></div></span></span></span></code></pre>{{</raw>}}
{{<raw>}}<pre class="CodeBlock CodeBlock-with-rows CodeBlock-scrolls-horizontally CodeBlock-is-light-in-light-theme CodeBlock--language-bash" language="bash"><code><span class="CodeBlock--rows"><span class="CodeBlock--rows-content"><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">tus-upload --chunk-size </span><span class="CodeBlock--token-number">52428800</span><span class="CodeBlock--token-plain"> --header Authorization </span><span class="CodeBlock--token-string">&quot;Bearer </span><span class="CodeBlock--token-string CodeBlock--token-variable">$TOKEN</span><span class="CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-variable">$PATH_TO_VIDEO</span><span class="CodeBlock--token-plain"> https://api.cloudflare.com/client/v4/accounts/</span><span class="CodeBlock--token-variable">$ACCOUNT</span><span class="CodeBlock--token-plain">/stream</span></div></span></span></span></code></pre>{{</raw>}}

At the beginning of the tus response, you will find the endpoint for getting information about your newly uploaded video.
{{<raw>}}<pre class="CodeBlock CodeBlock-with-rows CodeBlock-scrolls-horizontally CodeBlock-is-light-in-light-theme CodeBlock--language-bash" language="bash"><code><span class="CodeBlock--rows"><span class="CodeBlock--rows-content"><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">INFO Creating </span><span class="CodeBlock--token-function">file</span><span class="CodeBlock--token-plain"> endpoint</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">INFO Created: https://api.cloudflare.com/client/v4/accounts/d467d4f0fcbcd9791b613bc3a9599cdc/stream/dd5d531a12de0c724bd1275a3b2bc9c6</span></div></span></span></span></code></pre>{{</raw>}}

### Golang

Import a [tus](https://tus.io) client. You can use the [go-tus](https://github.com/eventials/go-tus) by [eventials](https://github.com/eventials) to upload from your Go applications.
{{<raw>}}<pre class="CodeBlock CodeBlock-with-rows CodeBlock-scrolls-horizontally CodeBlock-is-light-in-light-theme CodeBlock--language-go" language="go"><code><span class="CodeBlock--rows"><span class="CodeBlock--rows-content"><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-keyword">package</span><span class="CodeBlock--token-plain"> main</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	</span><span class="CodeBlock--token-string">&quot;net/http&quot;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	</span><span class="CodeBlock--token-string">&quot;os&quot;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	tus </span><span class="CodeBlock--token-string">&quot;github.com/eventials/go-tus&quot;</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-keyword">func</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-function">main</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	accountID </span><span class="CodeBlock--token-operator">:=</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-string">&quot;ACCOUNT ID&quot;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	f</span><span class="CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-plain"> err </span><span class="CodeBlock--token-operator">:=</span><span class="CodeBlock--token-plain"> os</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">Open</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-string">&quot;videofile.mp4&quot;</span><span class="CodeBlock--token-punctuation">)</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	</span><span class="CodeBlock--token-keyword">if</span><span class="CodeBlock--token-plain"> err </span><span class="CodeBlock--token-operator">!=</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-boolean">nil</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">		</span><span class="CodeBlock--token-function">panic</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-plain">err</span><span class="CodeBlock--token-punctuation">)</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	</span><span class="CodeBlock--token-punctuation">}</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	</span><span class="CodeBlock--token-keyword">defer</span><span class="CodeBlock--token-plain"> f</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">Close</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-punctuation">)</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	headers </span><span class="CodeBlock--token-operator">:=</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-function">make</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-plain">http</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-plain">Header</span><span class="CodeBlock--token-punctuation">)</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	headers</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">Add</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-string">&quot;Authorization&quot;</span><span class="CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-string">&quot;Bearer $TOKEN&quot;</span><span class="CodeBlock--token-punctuation">)</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	config </span><span class="CodeBlock--token-operator">:=</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-operator">&amp;</span><span class="CodeBlock--token-plain">tus</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-plain">Config</span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">		ChunkSize</span><span class="CodeBlock--token-punctuation">:</span><span class="CodeBlock--token-plain">           </span><span class="CodeBlock--token-number">50</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-operator">*</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-number">1024</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-operator">*</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-number">1024</span><span class="CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-comment">// Required a minimum chunk size of 5MB, here we use 50MB.</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">		Resume</span><span class="CodeBlock--token-punctuation">:</span><span class="CodeBlock--token-plain">              </span><span class="CodeBlock--token-boolean">false</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">		OverridePatchMethod</span><span class="CodeBlock--token-punctuation">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-boolean">false</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">		Store</span><span class="CodeBlock--token-punctuation">:</span><span class="CodeBlock--token-plain">               </span><span class="CodeBlock--token-boolean">nil</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">		Header</span><span class="CodeBlock--token-punctuation">:</span><span class="CodeBlock--token-plain">              headers</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">		HttpClient</span><span class="CodeBlock--token-punctuation">:</span><span class="CodeBlock--token-plain">          </span><span class="CodeBlock--token-boolean">nil</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	</span><span class="CodeBlock--token-punctuation">}</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	client</span><span class="CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-boolean">_</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-operator">:=</span><span class="CodeBlock--token-plain"> tus</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">NewClient</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-string">&quot;https://api.cloudflare.com/client/v4/accounts/&quot;</span><span class="CodeBlock--token-operator">+</span><span class="CodeBlock--token-plain"> accountID </span><span class="CodeBlock--token-operator">+</span><span class="CodeBlock--token-string">&quot;/stream&quot;</span><span class="CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-plain"> config</span><span class="CodeBlock--token-punctuation">)</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	upload</span><span class="CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-boolean">_</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-operator">:=</span><span class="CodeBlock--token-plain"> tus</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">NewUploadFromFile</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-plain">f</span><span class="CodeBlock--token-punctuation">)</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	uploader</span><span class="CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-boolean">_</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-operator">:=</span><span class="CodeBlock--token-plain"> client</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">CreateUpload</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-plain">upload</span><span class="CodeBlock--token-punctuation">)</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">	uploader</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">Upload</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-punctuation">}</span><span class="CodeBlock--token-plain">
</span></div></span></span></span></code></pre>{{</raw>}}

You can also get the progress of the upload if you are running the upload in a goroutine.
{{<raw>}}<pre class="CodeBlock CodeBlock-with-rows CodeBlock-scrolls-horizontally CodeBlock-is-light-in-light-theme CodeBlock--language-go" language="go"><code><span class="CodeBlock--rows"><span class="CodeBlock--rows-content"><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-comment">// returns the progress percentage.</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">upload</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">Progress</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-comment">// returns whether or not the upload is complete.</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">upload</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">Finished</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-plain">
</span></div></span></span></span></code></pre>{{</raw>}}

Refer to [go-tus](https://github.com/eventials/go-tus) on GitHub for functionality such as resuming uploads and getting details about the progress of the upload.

### Node.js

1. Install `tus-js-client`.
{{<raw>}}<pre class="CodeBlock CodeBlock-with-rows CodeBlock-scrolls-horizontally CodeBlock-is-light-in-light-theme CodeBlock--language-bash" language="bash"><code><span class="CodeBlock--rows"><span class="CodeBlock--rows-content"><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-function">npm</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-function">install</span><span class="CodeBlock--token-plain"> tus-js-client</span></div></span></span></span></code></pre>{{</raw>}}

2. Set up an `index.js` and configure:

* The API endpoint with your Cloudflare Account ID.
* The request headers to include an API token.
{{<raw>}}<pre class="CodeBlock CodeBlock-with-rows CodeBlock-scrolls-horizontally CodeBlock-is-light-in-light-theme CodeBlock--language-js" language="js"><code><span class="CodeBlock--rows"><span class="CodeBlock--rows-content"><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-keyword">var</span><span class="CodeBlock--token-plain"> fs </span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-function">require</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-string">&quot;fs&quot;</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-punctuation">;</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-keyword">var</span><span class="CodeBlock--token-plain"> tus </span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-function">require</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-string">&quot;tus-js-client&quot;</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-punctuation">;</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-comment">// specify location of file you'd like to upload below</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-keyword">var</span><span class="CodeBlock--token-plain"> path </span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain"> __dirname </span><span class="CodeBlock--token-operator">+</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-string">&quot;/test.mp4&quot;</span><span class="CodeBlock--token-punctuation">;</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-keyword">var</span><span class="CodeBlock--token-plain"> file </span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain"> fs</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">createReadStream</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-plain">path</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-punctuation">;</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-keyword">var</span><span class="CodeBlock--token-plain"> size </span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain"> fs</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">statSync</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-plain">path</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-plain">size</span><span class="CodeBlock--token-punctuation">;</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-keyword">var</span><span class="CodeBlock--token-plain"> mediaId </span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-string">''</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-keyword">var</span><span class="CodeBlock--token-plain"> options </span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-literal-property">endpoint</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-string">&quot;https://api.cloudflare.com/client/v4/accounts/{ACCOUNT ID}/stream&quot;</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-literal-property">headers</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">    </span><span class="CodeBlock--token-string-property">'Authorization'</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-string">'Bearer $TOKEN'</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-punctuation">}</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-literal-property">chunkSize</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-number">50</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-operator">*</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-number">1024</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-operator">*</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-number">1024</span><span class="CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-comment">// Required a minimum chunk size of 5MB, here we use 50MB.</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-literal-property">resume</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-boolean">true</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-literal-property">metadata</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">    </span><span class="CodeBlock--token-literal-property">filename</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-string">&quot;test.mp4&quot;</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">    </span><span class="CodeBlock--token-literal-property">filetype</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-string">&quot;video/mp4&quot;</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">    </span><span class="CodeBlock--token-literal-property">defaulttimestamppct</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-number">0.5</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">    </span><span class="CodeBlock--token-literal-property">watermark</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-string">&quot;$WATERMARKUID&quot;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-punctuation">}</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-literal-property">uploadSize</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> size</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-function-variable">onError</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-keyword">function</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-parameter">error</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">    </span><span class="CodeBlock--token-keyword">throw</span><span class="CodeBlock--token-plain"> error</span><span class="CodeBlock--token-punctuation">;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-punctuation">}</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-function-variable">onProgress</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-keyword">function</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-parameter">bytesUploaded</span><span class="CodeBlock--token-parameter CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-parameter"> bytesTotal</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">    </span><span class="CodeBlock--token-keyword">var</span><span class="CodeBlock--token-plain"> percentage </span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-plain">bytesUploaded </span><span class="CodeBlock--token-operator">/</span><span class="CodeBlock--token-plain"> bytesTotal </span><span class="CodeBlock--token-operator">*</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-number">100</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">toFixed</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-number">2</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-punctuation">;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">    console</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">log</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-plain">bytesUploaded</span><span class="CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-plain"> bytesTotal</span><span class="CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-plain"> percentage </span><span class="CodeBlock--token-operator">+</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-string">&quot;%&quot;</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-punctuation">;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-punctuation">}</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-function-variable">onSuccess</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-keyword">function</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">    console</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">log</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-string">&quot;Upload finished&quot;</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-punctuation">;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-punctuation">}</span><span class="CodeBlock--token-punctuation">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-function-variable">onAfterResponse</span><span class="CodeBlock--token-operator">:</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-keyword">function</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-parameter">req</span><span class="CodeBlock--token-parameter CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-parameter"> res</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">    </span><span class="CodeBlock--token-keyword">return</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-keyword">new</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-class-name">Promise</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-parameter">resolve</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-operator">=&gt</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">        </span><span class="CodeBlock--token-keyword">var</span><span class="CodeBlock--token-plain"> mediaIdHeader </span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain"> res</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">getHeader</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-string">&quot;stream-media-id&quot;</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-punctuation">;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">        </span><span class="CodeBlock--token-keyword">if</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-plain">mediaIdHeader</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-punctuation">{</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">            mediaId </span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain"> mediaIdHeader</span><span class="CodeBlock--token-punctuation">;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">        </span><span class="CodeBlock--token-punctuation">}</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">        </span><span class="CodeBlock--token-function">resolve</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-punctuation">)</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">    </span><span class="CodeBlock--token-punctuation">}</span><span class="CodeBlock--token-punctuation">)</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">  </span><span class="CodeBlock--token-punctuation">}</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-punctuation">}</span><span class="CodeBlock--token-punctuation">;</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-keyword">var</span><span class="CodeBlock--token-plain"> upload </span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-keyword">new</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-class-name">tus</span><span class="CodeBlock--token-class-name CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-class-name">Upload</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-plain">file</span><span class="CodeBlock--token-punctuation">,</span><span class="CodeBlock--token-plain"> options</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-punctuation">;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">upload</span><span class="CodeBlock--token-punctuation">.</span><span class="CodeBlock--token-function">start</span><span class="CodeBlock--token-punctuation">(</span><span class="CodeBlock--token-punctuation">)</span><span class="CodeBlock--token-punctuation">;</span><span class="CodeBlock--token-plain">
</span></div></span></span></span></code></pre>{{</raw>}}